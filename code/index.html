<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Code - MOCK-UP</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" disabled>
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" >
        <link href="../style.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
    <a class="navbar-brand" href=".."> MOCK-UP </a>
    <a class="navbar-brand" href=".."> <img style="width: 45px; margin: 0px; padding: 0px;" src="/mock-up/img/CFFDRS_Black_4.png" alt="CFFDRS logo"> </img> </a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../home/" class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Code</a>
                            </li>
                            <li class="nav-item">
                                <a href="../tutorials/" class="nav-link">Tutorials</a>
                            </li>
                            <li class="nav-item">
                                <a href="../resources/" class="nav-link">Resources</a>
                            </li>
                            <li class="nav-item">
                                <a href="../contact/" class="nav-link">Contact</a>
                            </li>
                            <li class="nav-item">
                                <a href="https://siu-kevin.github.io/maquette/accueil" class="nav-link">Français</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="2"><a href="#repository" class="nav-link">Repository</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#fwi2025-code" class="nav-link">FWI2025 Code</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#fwi2025-documentation" class="nav-link">FWI2025 Documentation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#license" class="nav-link">License</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="repository">Repository</h2>
<p>The <a href="https://github.com/nrcan-cfs-fire/cffdrs-ng/tree/main">cffdrs-ng GitHub repository</a> contains the up-to-date code for the CFFDRS2025 modules in three programming languages: R, C, and Python. All three languages contain the same equations and perform the same tasks, the choice is yours depending on your system requirement.</p>
<p>The <a href="https://cwfis.cfs.nrcan.gc.ca/background/summary/fwi">Canadian Forest Fire Weather Index (FWI)</a> is a major subsystem of the CFFDRS. FWI2025 is the next generation FWI system corresponding to the CFFDRS2025. Below describes the files, data inputs, parameters, and outputs in a general way for all three languages, any deviations for a specific language will be noted. </p>
<h2 id="fwi2025-code">FWI2025 Code</h2>
<h3 id="scripts">Scripts</h3>
<p>Each programming language has two scripts that are required to generate FWI2025 outputs:</p>
<ol>
<li>
<p>"NG_FWI" holds the functions and equations for generating FWI2025 outputs.</p>
<p>R : <strong>NG_FWI.r</strong><br />
Python : <strong>NG_FWI.py</strong><br />
C : <strong>NG_FWI.c</strong></p>
</li>
<li>
<p>"util" includes basic functions that are not part of FWI2025 equations, but generate intermediate information for the calculation of the FWI2025 components (e.g. time of sunrise and sunset, number of sunlight hours).  This script also includes the process to generate the daily summary output.</p>
<p>R : <strong>util.r</strong><br />
Python : <strong>util.py</strong><br />
C : <strong>util.c</strong>, <strong>util.h</strong></p>
</li>
</ol>
<h3 id="packages">Packages</h3>
<p>The FWI2025 scripts require different sets of language-specific libraries or packages.  These must be installed prior to running "NG_FWI".</p>
<p>R : lubridate and data.table<br />
Python : datetime, logging, math, numpy, pandas, os.path, sys<br />
C : stdlib.h, stdbool.h, string.h</p>
<h3 id="get-started">Get Started</h3>
<p>The <a href="https://github.com/nrcan-cfs-fire/cffdrs-ng/tree/main">cffdrs-ng GitHub repository</a> also includes a tutorial script and test data. See the <a href="../tutorials/#how-to-calculate-hourly-fwi-the-new-fwi2025">Tutorial page</a> for a step-by-step workflow with hourly data. The documentation below goes into details about specific functions and data requirements.</p>
<h2 id="fwi2025-documentation">FWI2025 Documentation</h2>
<p>FWI2025 code is written for and tested using input data in the form of a table/array, commonly imported as comma-separated value (.csv) files. Outputs are then also of the same form.  Users can configure the input and output file types to fit their individual data streams.</p>
<p>See the <a href="../tutorials/#how-to-calculate-hourly-fwi-the-new-fwi2025">How to calculate hourly FWI</a> tutorial for an example that applies the FWI2025 code on a publicly available dataset.</p>
<h3 id="hourly-fire-weather-index">Hourly Fire Weather Index</h3>
<p>The <code>hFWI()</code> function in the "NG_FWI" file is built to generate FWI System outputs one station at a time. The R and Python versions can also output multiple stations with a properly formatted input. The C version can only handle inputs of a single year for a given station.</p>
<h4 id="input-data">Input Data</h4>
<p>The Fire Weather Index System was originally designed to be calculated using data recorded at local <em>weather stations</em>.  As a result, descriptions below reference weather station data as input.  In reality, any collected or calculated weather data (e.g. gridded data, forecast data, etc.) that includes the standard variables required as input to the FWI System can be used. See the <a href="https://ostrnrcan-dostrncan.canada.ca/handle/1845/219568">Weather Guide</a> for a description of weather data input standards for the FWI System.</p>
<p>The rows of the dataframe should correspond to consecutive hourly data. The columns and data types of the input dataframe are as follows:</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>Weather station identifier, a unique number for the station, text or number</td>
</tr>
<tr>
<td><code>lat</code></td>
<td>Latitude. Location of weather station, decimal degrees (double precision)</td>
</tr>
<tr>
<td><code>long</code></td>
<td>Longitude. Location of weather station, decimal degrees (double precision)</td>
</tr>
<tr>
<td><code>yr</code></td>
<td>Year of weather station reading, number YYYY</td>
</tr>
<tr>
<td><code>mon</code></td>
<td>Month of weather station reading, number M or MM (must be consistent throughout the dataset)</td>
</tr>
<tr>
<td><code>day</code></td>
<td>Day of weather station reading, number DD or D (must be consistent throughout the dataset)</td>
</tr>
<tr>
<td><code>hr</code></td>
<td>Hour of weather station reading, number in military time (0-23)</td>
</tr>
<tr>
<td><code>temp</code></td>
<td>Temperature in °Celsius, number</td>
</tr>
<tr>
<td><code>rh</code></td>
<td>Relative humidity in percent, number (0-100)</td>
</tr>
<tr>
<td><code>ws</code></td>
<td>Wind speed in km/hr, number</td>
</tr>
<tr>
<td><code>prec</code></td>
<td>Precipitation (rain) measured in millimeters (mm), number</td>
</tr>
<tr>
<td><code>solrad</code></td>
<td>Solar Radiation measured in kw/m2 (kilowatts per meter squared) for grassland codes, number.  OPTIONAL input, FWI2025 will generate based on default method. (<a href="">read more about solar radiation sensors and minimum requirements</a>)</td>
</tr>
<tr>
<td><code>percent_cured</code></td>
<td>Percent Cured of grasses in open grassland, measured in percent for grassland codes, number (0-100). OPTIONAL input, FWI2025 will generate based on default method</td>
</tr>
</tbody>
</table>
<p>The column headers can be lower case or upper case, the output format is set to upper case.</p>
<p>In addition to the weather variables, the function to generate hourly FWI2025 outputs requires the timezone where the weather station is located and the start-up value for the moisture codes (e.g. FFMC of 85, DMC of 6 and DC of 15). See the next section below to see where it is specified.</p>
<h4 id="function-parameters">Function Parameters</h4>
<p>R :</p>
<pre><code class="language-r">hFWI(df_wx, timezone, ffmc_old = 85, dmc_old = 6, dc_old = 15)
</code></pre>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>df_wx</code></td>
<td>data frame or formatted table (can have multiple years and stations, needs to be temporally sequential during a given year)</td>
</tr>
<tr>
<td><code>timezone</code></td>
<td>timezone in which the weather station is located as the number of offset hours from UTC (e.g. for stations in Central Standard time the timezone is set to -6)</td>
</tr>
<tr>
<td><code>ffmc_old</code></td>
<td></td>
</tr>
<tr>
<td><code>dmc_old</code></td>
<td>the start-up value of the duff moisture code (e.g. 6, this is the default)</td>
</tr>
<tr>
<td><code>dc_old</code></td>
<td>the start-up value of the drought code (e.g. 15, this is the default)</td>
</tr>
</tbody>
</table>
<p>Python :</p>
<pre><code class="language-python">hFWI(df_wx, ffmc_old = 85, dmc_old = 6, dc_old = 15, silent = False)
</code></pre>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>df_wx</code></td>
<td>data frame or formatted table (can have multiple years and stations, needs to be temporally sequential during a given year)</td>
</tr>
<tr>
<td><code>timezone</code></td>
<td>timezone in which the weather station is located</td>
</tr>
<tr>
<td><code>ffmc_old</code></td>
<td>the startup value of the fine fuel moisture code (e.g. 85, this is the default)</td>
</tr>
<tr>
<td><code>dmc_old</code></td>
<td>the start-up value of the duff moisture code (e.g. 6, this is the default)</td>
</tr>
<tr>
<td><code>dc_old</code></td>
<td>the start-up value of the drought code (e.g. 15, this is the default)</td>
</tr>
<tr>
<td><code>silent</code></td>
<td>print progress messages to monitor script. True or False, False by default</td>
</tr>
</tbody>
</table>
<p>C :</p>
<p>The C version can be run from command line with the following arguments in order:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>local GMToffset</td>
<td>timezone in which the weather station is located</td>
</tr>
<tr>
<td>starting FFMC</td>
<td>the startup value of the fine fuel moisture code (e.g. 85)</td>
</tr>
<tr>
<td>starting DMC</td>
<td>the start-up value of the duff moisture code (e.g. 6)</td>
</tr>
<tr>
<td>starting DC</td>
<td>the start-up value of the drought code (e.g. 15)</td>
</tr>
<tr>
<td>input file</td>
<td>name of .csv file containing data for a single station over the course of a year</td>
</tr>
<tr>
<td>output file</td>
<td>name of the file to output results into</td>
</tr>
</tbody>
</table>
<h4 id="output-description">Output Description</h4>
<p>The output is also the same format as the input data, with the following columns appended: </p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>timestamp</code></td>
<td>date and time of weather and FWI variable. Timestamp YYYY-MM-DD HH:MM:SS. (not in C)</td>
</tr>
<tr>
<td><code>date</code></td>
<td>YYYY-MM-DD Date type (without hh:mm:ss). (not in C)</td>
</tr>
<tr>
<td><code>sunrise</code></td>
<td>Time of sunrise based on the latitude, longitude, and date (decimal time). (not in C)</td>
</tr>
<tr>
<td><code>sunset</code></td>
<td>Time of sunset based on the latitude, longitude, and date (decimal time). (not in C)</td>
</tr>
<tr>
<td><code>sunlight_hours</code></td>
<td>Number of hours between sunrise and sunset (decimal time). (not in C)</td>
</tr>
<tr>
<td><code>solrad</code></td>
<td>Solar Radiation measured in kw/m2 (kilowatts per meter squared) for grassland codes, generated automatically if missing from input (number). (needs to be calculated using make_inputs.c if not given)</td>
</tr>
<tr>
<td><code>percent_cured</code></td>
<td>percent of cured (dead) grass fuels in grasslands, generated automatically if missing from input.  Used exclusively in the Grassland calculations.  Percentage as number (0-100). (needs to be calculated using make_inputs.c if not given)</td>
</tr>
<tr>
<td><code>grass_fuel_load</code></td>
<td>The standard grass fuel load is built into the Python and R code, 0.35kg/m2.  (needs to be calculated using make_inputs.c if not given, generates a column with the standard value)</td>
</tr>
<tr>
<td><code>ffmc</code></td>
<td>Fine Fuel Moisture Code (number)</td>
</tr>
<tr>
<td><code>dmc</code></td>
<td>Duff Moisture Code (number)</td>
</tr>
<tr>
<td><code>dc</code></td>
<td>Drought Code (number)</td>
</tr>
<tr>
<td><code>isi</code></td>
<td>Initial Spread Index (number)</td>
</tr>
<tr>
<td><code>bui</code></td>
<td>Buildup Index (number)</td>
</tr>
<tr>
<td><code>fwi</code></td>
<td>Fire Weather Index (number)</td>
</tr>
<tr>
<td><code>dsr</code></td>
<td>Daily Severity Rating (number)</td>
</tr>
<tr>
<td><code>gfmc</code></td>
<td>Grass Fuel Moisture Code, 0-101 similar to FFMC (number)</td>
</tr>
<tr>
<td><code>gsi</code></td>
<td>Grassland Spread Index (number)</td>
</tr>
<tr>
<td><code>gfwi</code></td>
<td>Grassland Fire Weather Index (number)</td>
</tr>
</tbody>
</table>
<h3 id="daily-summaries">Daily Summaries</h3>
<p>The hourly FWI output can be summarized in a variety of ways depending on usage and requirements. These can be found within the ‘util’ file. <code>generate_daily_summaries()</code> boils down the hourly data into some daily metrics. </p>
<h4 id="input-data_1">Input Data</h4>
<p>The only input to <code>generate_daily_summaries()</code> is the output from <code>hFWI()</code>.</p>
<h4 id="function-parameters_1">Function Parameters</h4>
<p>R :  </p>
<pre><code class="language-r">generate_daily_summaries &lt;- function(hourly_data) {}
</code></pre>
<p>Python : </p>
<pre><code class="language-python">def generate_daily_summaries(hourly_data): 
</code></pre>
<p>C : </p>
<pre><code class="language-c">hourly_data = the output dataframe generated by NG_FWI
</code></pre>
<h3 id="output-description_1">Output Description</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>wstnid</code></td>
<td>weather station id, or unique identifier for the weather station</td>
</tr>
<tr>
<td><code>year</code></td>
<td>Year, YYYY, number (e.g. 2024)</td>
</tr>
<tr>
<td><code>mon</code></td>
<td>month, M, number (e.g. 3)</td>
</tr>
<tr>
<td><code>day</code></td>
<td>day, D number (e.g. 8)</td>
</tr>
<tr>
<td><code>sunrise</code></td>
<td>Time of sunrise. HH:MM:SS timestamp format in military time (e.g. 06:30:55)</td>
</tr>
<tr>
<td><code>sunset</code></td>
<td>Time of sunset. HH:MM:SS timestamp format in military time (e.g. 19:45:05)</td>
</tr>
<tr>
<td><code>peak_time</code></td>
<td>The hour, H in military time (0-23),  number format. The hour where one might expect maximum fire behaviour as expressed by a modified ISI (see definitions of wind_speed_smoothed and peak_isi_smoothed below).  If the peak ISI (from peak_isi_smoothed field) is less than five, the peak_time is set to 17:00 hours</td>
</tr>
<tr>
<td><code>duration</code></td>
<td>number of hours, number format.  Can also be called duration of a burning window, number of hours in the day where one could expect an active fire (where a modified ISI is equal or greater than five).  If the ISI did not reach 5 or greater, the duration is zero</td>
</tr>
<tr>
<td><code>wind_speed_smoothed</code></td>
<td>Wind Speed (km/hr), double precision. Hourly wind speed recorded based on a 10 min average can be noisy hour-to-hour, this makes it difficult to estimate the duration of a burning window.  To estimate the duration of a burning window and peak time, the hourly windspeed is smoothed and the ISI is recalculated based on the smoothed wind speed and FFMC</td>
</tr>
<tr>
<td><code>peak_isi_smoothed</code></td>
<td>Maximum Initial Spread Index (ISI) recalculated based on FFMC and smoothed wind speed from ‘wind_speed_smoothed’, double precision number.  Number, double precision</td>
</tr>
<tr>
<td><code>ffmc</code></td>
<td>Fine Fuel Moisture Code corresponding to the FFMC at the hour of peak time. Number, double precision</td>
</tr>
<tr>
<td><code>dmc</code></td>
<td>Duff Moisture Code corresponding to the DMC at the hour of peak. Number, double precision</td>
</tr>
<tr>
<td><code>dc</code></td>
<td>Drought Code corresponding to the DC at the hour of peak time. Number, double precision</td>
</tr>
<tr>
<td><code>isi</code></td>
<td>Initial Spread Index corresponding to the ISI at the hour of peak time. Number, double precision</td>
</tr>
<tr>
<td><code>bui</code></td>
<td>Buildup Index corresponding to the BUI at the hour of peak time. Number, double precision</td>
</tr>
<tr>
<td><code>fwi</code></td>
<td>Fire Weather Index corresponding to the FWI at the hour of peak time. Number, double precision</td>
</tr>
<tr>
<td><code>dsr</code></td>
<td>Daily Severity Rating corresponding to the DSR at the hour of peak time. Number, double precision</td>
</tr>
<tr>
<td><code>gfmc</code></td>
<td>Grass Fuel Moisture Code corresponding to the GFMC at the hour of peak time. Number, double precision</td>
</tr>
<tr>
<td><code>gsi</code></td>
<td>Grassland Spread Index corresponding to the GSI at the hour of peak time. Number, double precision</td>
</tr>
<tr>
<td><code>gfwi</code></td>
<td>Grassland Fire Weather Index corresponding to the GFWI at the hour of peak time. Number, double precision</td>
</tr>
</tbody>
</table>
<h3 id="functions">Functions</h3>
<p><a href="r">R</a><br />
<a href="python">Python</a><br />
<a href="c">C</a>  </p>
<h2 id="license">License</h2></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
